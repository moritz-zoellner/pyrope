<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pyrope Aufgabenübersicht</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Pyrope Aufgabenübersicht</h1>
    <div class="main-container">
        <div id="task-list" class="task-list"></div>
        <iframe id="task-frame" src="" frameborder="0"></iframe>
    </div>

    <script>
        async function fetchStructure() {
            const res = await fetch('/structure');
            return await res.json();
        }

        function createTaskList(structure, basePath = '', indent = 0) {
            const container = document.createElement('div');
            container.classList.add('task-sublist');
            container.style.marginLeft = `${indent * 20}px`;

            structure.forEach(item => {
                if (item.type === 'exercise') {
                    const button = document.createElement('p');
                    button.textContent = item.name;
                    button.onclick = () => {
                        document.getElementById('task-frame').src = `http://localhost:8866/voila/render/${basePath}${item.name}?`;
                    };
                    container.appendChild(button);
                } else if (item.type === 'pool') {
                    const label = document.createElement('div');
                    label.textContent = item.name;
                    label.classList.add('pool-label');
                    container.appendChild(label);
                    container.appendChild(createTaskList(item.items, `${basePath}${item.name}/`, indent + 1));
                }
            });

            return container;
        }

        fetchStructure().then(structure => {
            const root = document.getElementById('task-list');
            root.appendChild(createTaskList(structure));
        });
    </script>
</body>
</html>
